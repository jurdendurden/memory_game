// List of automobile manufacturers
const animals = [
    'Beetle', 'Butterfly', 'Camel', 'Chameleon', 'Cobra', 'Cow', 'Crab', 'Crocodile',
    'Dog', 'Elephant', 'Elk', 'Frog', 'Hippo', 'Kangaroo', 'Lion', 'Macaw',
    'Mianyang', 'Monkey', 'Mouse', 'Ostrich', 'Owl', 'Panda', 'Pelican', 'Penguin',
    'Raccoon', 'Rooster', 'Shark', 'Snake', 'Toucan', 'Turtle', 'Whale', 'Fish'
];

const christmas = [
    'Angel', 'Beanie', 'Bell', 'Bitten Cookie', 'Boy in Hat', 'Candle', 'Candy', 'Celsius',
    'Chimney', 'Christmas Card', 'Christmas Sweater', 'Christmas Tree Presents', 'Christmas Tree', 'Decoration', 'Elf', 'Gift',
    'Gingerbread Man', 'Girl in Hat', 'Mittens', 'Reindeer', 'Santa Claus', 'Gift Bag', 'Shining Light', 'Sleigh',
    'Snow Globe', 'Snowflake', 'Snowflake 2', 'Snowman', 'Star', 'Stocking', 'Turkey Dinner', 'Wreath'
];

const companies = [
    'Amazon', 'Android', 'Apple', 'Blogger', 'Chrome', 'Drive', 'Dropbox', 'Evernote',
    'Facebook', 'Fancy', 'Feedly', 'Firefox', 'Internet Explorer', 'Messenger', 'Opera', 'Paypal',
    'Photoshop', 'Pinterest', 'Reddit', 'RSS', 'Shopify', 'Skype', 'Snapchat', 'Soundcloud',
    'Spotify', 'Stack Overflow', 'Tinder', 'Twitter', 'Vine', 'Windows', 'Wordpress', 'Youtube'
];

const education = [
    'Abacus', 'Backpack', 'Baseball', 'Basketball', 'Bell', 'Book', 'Books', 'Calculator', 
    'Caliper', 'Calligraphy', 'Carpenter Square', 'Certificate', 'Eraser', 'Football', 'Globe', 'Graduate Cap', 
    'Graduating', 'Highlighter', 'Laptop', 'Magnifier', 'Paintbrush', 'Pen', 'Pencil', 'Protractor', 
    'Report', 'Ribbon', 'Ruler', 'School ID', 'Schoolhouse', 'Smart Board', 'Trophy', 'Try Square'
];

const emoji = [
    'Angry', 'Anxious Sweat', 'Blowing a Kiss', 'Confused', 'Crying', 'Cursing', 'Devil', 'Dizzy',
    'Expressionless', 'Giggling', 'Hugging', 'Laughing', 'Nauseated', 'Nervous', 'Partying', 'Pouting',
    'Rolling Eyes', 'Savoring Food', 'Shushing', 'Sleeping', 'Angel', 'Smiling Hearts', 'Smiling Sunglasses', 'Smiling',
    'Sneezing', 'Spiral Eyes', 'Star Struck', 'Tongue', 'Winking Tongue', 'Yawning', 'Zany', 'Zipper Mouth'
];

const fantasy = [
    'Archer', 'Axe', 'Banner', 'Battle Axe', 'Bolt Shield', 'Broadsword', 'Campfire', 'Castle', 
    'Crossbow', 'Crown', 'Dragon', 'Fireball', 'Flask', 'Fortress', 'Health Potion', 'Helmet', 
    'Hydra', 'Inkwell', 'Key', 'Knife', 'Large Hammer', 'Meat', 'Parchment', 'Scythe', 
    'Sea Serpent', 'Shield', 'Siege', 'Skull', 'Snake', 'Target', 'Torch', 'Trophy'
];

const foods = [
    'Apple', 'Bread', 'Celery', 'Cheese', 'Cherry', 'Cookies', 'Corn', 'Cucumber',
    'Hamburger', 'Kiwi', 'Lettuce', 'Macaron', 'Melon', 'Milk', 'Nachos', 'Pancake',
    'Peanuts', 'Peas', 'Pie', 'Pineapple', 'Pizza', 'Plum', 'Pomegranate', 'Porridge',
    'Pretzel', 'Raspberry', 'Steak', 'Strawberry', 'Taco', 'Turkey', 'Tomato', 'Watermelon'
];

const halloween = [
    'Bat', 'Bloody Axe', 'Bloody Knife', 'Candle', 'Candy', 'Cat', 'Cauldron', 'Casket',
    'Clown', 'Cthulhu', 'Death', 'Evil Hand', 'Frankenstein', 'Gallows', 'Ghost', 'Grave Monument',
    'Grave', 'Grim Reaper', 'Jason', 'Owl', 'Pirate Skeleton', 'Pirate Skull', 'Poison', 'Pumpkin',
    'Skeleton', 'Skull', 'Spider', 'Witch', 'Zombie Hand', 'Zombie', 'Cyclops', 'Scream'
];

const hotel = [
    'Bowling', 'Breakfast', 'Broom', 'Clock', 'Credit Card', 'Dental Equipment', 'Electric Iron', 'Elevator',
    'Hair Dryer', 'Hairdressing', 'Key', 'Landline', 'Luggage Rack', 'Morning Call', 'Newspaper', 'No Fires',
    'Order Food', 'Pen and Paper', 'Pet', 'Phone Service', 'Safe', 'Single Bed', 'Sink', 'Taxi Service',
    'Bathtub', 'Toilet Paper', 'Toiletries', 'Towel', 'TV', 'Vaccuum', 'Washing Machine', 'WIFI'
];

const manufacturers = [
    'Toyota', 'Honda', 'Ford', 'Chevrolet', 'Nissan', 'BMW', 'Mercedes', 
    'Volkswagen', 'Audi', 'Hyundai', 'Kia', 'Volvo', 'Jaguar', 'Subaru', 
    'Porsche', 'Mazda', 'Ferrari', 'Lamborghini', 'Bentley', 'Rolls Royce', 
    'Tesla', 'Jeep', 'Land Rover', 'Mitsubishi', 'Suzuki', 'Peugeot', 
    'Renault', 'Fiat', 'Chrysler', 'GMC', 'Buick', 'Dodge'
];

const space = [
    'Alien', 'Asteroid', 'Astronaut Helmet', 'Astronaut', 'Atom', 'Big Dipper', 'Black Hole', 'Brain Slug',
    'Cassiopeia', 'Comet', 'Earth', 'Falling Asteroid', 'Falling Space Capsule', 'Falling Star', 'Flag', 'Full Moon',
    'Galaxy', 'ISS', 'Jupiter', 'Landing Pod', 'Laser Gun', 'Mars', 'Dreamy Moon', 'Observatory',
    'Ring Ship', 'Rocket Launch', 'Rocket', 'Satellite', 'Saturn', 'Solar System', 'Space Capsule', 'Space Rocket'
];

let first_tile = null;
let second_tile = null;
let lock_board = false;
let matches_found = 0;
let game_size;
let score = 0;
let tries_left = 0;
let total_tries = 0;
let mode = ''; // Game mode: 'limited' or 'unlimited'
let tries_used = 0; // Count tries used for unlimited mode
let theme = 'automobiles'
let match_count = 0;
let selected_color = 'blue';

// Shuffle array function
function shuffle(array) {
    for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
    }
    return array;
}

// Select Background Color using jscolor
function select_bg_color(jscolor) {
    if (jscolor === 'pumpkin') {        
        document.body.style.backgroundImage = "url('./images/backgrounds/pumpkin.svg')";              
    } else if (jscolor === 'thanksgiving') {        
        document.body.style.backgroundImage = "url('./images/backgrounds/thanksgiving.svg')";                
    } else {    
        document.body.style.backgroundImage = "none"; // Clear any background image
        document.body.style.backgroundPosition = "center center";
        // Get the selected color from the jscolor object
        let color = `${jscolor}`;
        console.log("Selected color: ", color);

        // Set the body's background color
        document.body.style.backgroundColor = color;    
    }
}

// Select theme
function select_theme(selected_theme) {
    theme = selected_theme;
    
    // Remove 'selected' class from all theme buttons
    document.querySelectorAll('#theme_selection button').forEach(button => {
        button.classList.remove('selected');
    });
    
    // Add 'selected' class to the clicked theme button
    const theme_button = document.querySelector(`button[onclick="select_theme('${selected_theme}')"]`);
    if (theme_button) theme_button.classList.add('selected');
    
    document.getElementById('board_size_selection').style.display = 'block';
}

// Select game mode
function select_mode(selected_mode) {
    mode = selected_mode;
    
    // Remove 'selected' class from all mode buttons
    document.querySelectorAll('#start_window button').forEach(button => {
        button.classList.remove('selected');
    });
    
    // Add 'selected' class to the clicked mode button
    const mode_button = document.querySelector(`button[onclick="select_mode('${selected_mode}')"]`);
    if (mode_button) mode_button.classList.add('selected');
    
    document.getElementById('theme_selection').style.display = 'block';
}

// Start game
function start_game(size) {
    game_size = size;
    score = 0;
    matches_found = 0;
    tries_used = 0;
    match_count = 0;
    
    // Remove 'selected' class from all size buttons
    document.querySelectorAll('#board_size_selection button').forEach(button => {
        button.classList.remove('selected');
    });
    
    // Add 'selected' class to the clicked size button
    const size_button = document.querySelector(`button[onclick="start_game(${size})"]`);
    if (size_button) size_button.classList.add('selected');

    if (mode === 'limited') {
        if (game_size === 4) total_tries = 20;
        else if (game_size === 6) total_tries = 40;
        else if (game_size === 8) total_tries = 75;
        tries_left = total_tries;
        document.getElementById('tries_display').innerText = 'Tries Left: ' + tries_left;
    } else if (mode === 'unlimited') {
        tries_left = Infinity;
        document.getElementById('tries_display').innerText = 'Tries Used: ' + tries_used;
    }
    
    update_score();
    document.getElementById('start_window').style.display = 'none';
    document.getElementById('game_window').style.display = 'block';
    create_board();
}

// Create game board
function create_board() {
    const board = document.getElementById('game_board');
    board.innerHTML = '';
    board.style.gridTemplateColumns = `repeat(${game_size}, 100px)`;

    let tile_count = (game_size * game_size) / 2;        
    let items;

    // Select the appropriate list based on the theme
    if (theme === 'animals') {
        items = shuffle(animals.slice(0, tile_count));
    } else if (theme === 'automobiles') {
        items = shuffle(manufacturers.slice(0, tile_count));
    } else if (theme === 'christmas') {
        items = shuffle(christmas.slice(0, tile_count));
    } else if (theme === 'companies') {
        items = shuffle(companies.slice(0, tile_count));
    } else if (theme === 'education') {
        items = shuffle(education.slice(0, tile_count));
    } else if (theme === 'emoji') {
        items = shuffle(emoji.slice(0, tile_count));
    } else if (theme === 'fantasy') {
        items = shuffle(fantasy.slice(0, tile_count));
    } else if (theme === 'food') {
        items = shuffle(foods.slice(0, tile_count));
    } else if (theme === 'halloween') {
        items = shuffle(halloween.slice(0, tile_count));
    } else if (theme === 'hotels') {
        items = shuffle(hotel.slice(0, tile_count));
    } else if (theme === 'space') {
        items = shuffle(space.slice(0, tile_count));
    }

    let tiles = shuffle([...items, ...items]);

    tiles.forEach(item => {
        const tile = document.createElement('div');
        tile.classList.add('tile');
        tile.innerHTML = `
            <div class="tile_inner">
                <div class="tile_front">?</div>
                <div class="tile_back">
                    <div class="tile_name">${item}</div>
                    <div class="logo" style="background-image: url('images/${theme}/${item}.svg')"></div>
                </div>
            </div>
        `;
        tile.addEventListener('click', flip_tile);
        board.appendChild(tile);
    });    
}

// Flip tile logic
function flip_tile() {
    if (lock_board || this === first_tile || tries_left === 0) return;

    this.classList.add('flipped');

    if (!first_tile) {
        first_tile = this;
    } else {
        second_tile = this;
        check_match();
    }
}

// Check if tiles match
function check_match() {
    lock_board = true;
    let is_match = first_tile.querySelector('.logo').style.backgroundImage === second_tile.querySelector('.logo').style.backgroundImage;

    tries_used++;

    if (mode === 'limited') {
        tries_left--;
        if (tries_left === 0) {
            setTimeout(() => {
                alert('Game Over! Out of tries. Final Score: ' + score);
                new_game();
            }, 500);
            return;
        }
    }        

    if (is_match) 
    {
        score += 20;
        match_count++;
        if (match_count == 2)
            score *= 1.25;        
        else if (match_count >= 3)
        {
            match_count = 0;
            score *= 2;
        }
        score = Math.round(score);
        disable_tiles();    
        update_score(true);    
    } 
    else 
    {
        match_count = 0;
        if (score >= 2)
            score -= 2;        
        unflip_tiles();
        update_score(false);
    }
    
    update_tries_display();
}

// Disable matched tiles
function disable_tiles() {
    first_tile.removeEventListener('click', flip_tile);
    second_tile.removeEventListener('click', flip_tile);
    reset_board();
    matches_found++;

    if (matches_found === (game_size * game_size) / 2) {
        setTimeout(() => {
            alert('You won!\nFinal Score: ' + score + '\nTries: ' + tries_used);
            new_game();
        }, 500);
    }
}

// Unflip tiles
function unflip_tiles() {
    setTimeout(() => {
        first_tile.classList.remove('flipped');
        second_tile.classList.remove('flipped');
        reset_board();
    }, 1000);
}

// Reset board state
function reset_board() {
    [first_tile, second_tile] = [null, null];
    lock_board = false;
}

// Update score display
function update_score(is_match) {
    const scoreDisplay = document.getElementById('score_display');
    scoreDisplay.innerText = 'Score: ' + score;

    if (is_match) {
        // Trigger the animation by adding the class if there is a match
        scoreDisplay.classList.add('animate-score');

        // Remove the class after the animation ends to allow it to be triggered again
        setTimeout(() => {
            scoreDisplay.classList.remove('animate-score');
        }, 500); // Match the duration of the animation (0.5s)
    }
}

// Update tries or tries used display
function update_tries_display() {
    if (mode === 'limited') {
        document.getElementById('tries_display').innerText = 'Tries Left: ' + tries_left;
    } else {
        document.getElementById('tries_display').innerText = 'Tries Used: ' + tries_used;
    }
}

// Start new game
function new_game() 
{
    document.getElementById('game_window').style.display = 'none';
    document.getElementById('start_window').style.display = 'block';
    matches_found = 0;
}

// Quit game
function quit_game() 
{
    if (confirm('Are you sure you want to quit?')) 
        window.close();
}
